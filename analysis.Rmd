---
title: "Wind Turbine Analysis"
maketitle: true
author: Sarah Tang
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(messages = FALSE, warnings = FALSE, cache = TRUE)
```

## Set Up
```{r include=FALSE}
library("tidyverse")
library("ggplot2")
library("raster")
library("sf")
library("tmap")
library("USAboundaries")
library("httr")
library("jsonlite")
```

## Introduction
This module aims to examine and better understand how wind turbine development impacts bird populations, specifically for the whooping crane (Grus americana), one of the most endangered birds in North America. As land use needed for wind energy increases, it is crucial to understand the relationship between wind turbines, both while operating and installing, and animals' responses and wildlife habitat.

Whooping crane corridor - https://www.sciencebase.gov/catalog/item/5a314a72e4b08e6a89d707e0
Whooping crane - https://www.arcgis.com/home/item.html?id=7d27571bc3454a1c91edf665c67b9c3e


## Loading in files
```{r}
wind_turbines <- st_read("uswtdbSHP/uswtdb_v1_2_20181001.shp", quiet=TRUE)
whooping_crane_corridors <- st_read("WHCR_corridors/WHCR_corridors.shp", quiet=TRUE)

wind_turbines
whooping_crane_corridors
```

# Mapping Wind Turbines
Next, I plot the maps of the location of wind turbines using `ggplot` and the `geom_sf` command.
```{r}
#ggplot(wind_turbines) + geom_sf()
tm_shape(wind_turbines) + tm_dots()
```

I then overlay the locations of the wind turbines on a map of the United States.
```{r}
land <- us_states()
land

tmap_mode(mode = "plot") #change mode to plot

tm_shape(land) +
  tm_polygons("state_name", legend.show = FALSE) +
  tm_shape(wind_turbines) +
  tm_dots() +
  tm_grid(projection = "longlat", labels.size = .5, n.x = 5, n.y = 5)
  
```

# Mapping Whooping Crane Migratory Paths
```{r}
ggplot(whooping_crane_corridors) + geom_sf() + ggtitle("Whooping Crane Migration Corridor")
```

## Are there overlaps in the location of wind turbine sites and whooping crane migratory patterns?
```{r}
tm_shape(land) +
  tm_polygons("state_name", legend.show = FALSE) +
  tm_shape(whooping_crane_corridors) +
  tm_polygons() +
  tm_shape(wind_turbines) +
  tm_dots() +
  tm_grid(projection = "longlat", labels.size = .5, n.x = 5, n.y = 5) +
  tmap_options(max.categories = 52)
```


#Other bird populations?

```{r}
genus <- "Grus"
species <- "americana"
api_call <- paste0("http://api.iucnredlist.org/index/species/", genus, "-", species, ".json")

resp <- GET(api_call)
resp

status <- httr::status_code(resp)

out <- content(resp, as = "text")
df <- jsonlite::fromJSON(out)
rationale <- df$rationale
df
```


#TODO:

Custom R functions
Interaction with an API? - maybe just get the birds? what birds are potentially endangered/extinct?
Use lintr to clean code (checks adherence to a given style, syntax errors and possible semantic issues)
Making layout and presentation into secondary output (e.g. .pdf, website) - should enhance presentaiton
Use of spatial vector data (sf package) and visualization of spatial data



# TODO
Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
